<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Inherit the Job Position "Configuration" form view -->
        <record id="hr_job_view_form_inherit_bulk_gemini" model="ir.ui.view">
            <field name="name">hr.job.form.inherit.bulk.gemini</field>
            <field name="model">hr.job</field>
            <!-- 
                Inherit the base 'hr.view_hr_job_form', which is
                the view used when clicking "Configuration" on the kanban card.
            -->
            <field name="inherit_id" ref="hr.view_hr_job_form"/>
            <field name="priority">99</field>
            <field name="arch" type="xml">
                
                <!-- 
                    Add the new tab.
                    We target the notebook, which exists in the base view.
                -->
                <xpath expr="//notebook" position="inside">
                    <page string="Bulk CV Processing (Gemini)" name="bulk_cv_processing_gemini">
                        <group>
                            <group>
                                <field name="cv_attachment_ids"
                                       widget="many2many_binary"
                                       string="CVs to Process"
                                       readonly="processing_in_progress"/>
                                <field name="processed_cv_attachment_ids"
                                       widget="many2many_tags"
                                       string="Processed CVs"
                                       readonly="1"
                                       nolabel="0"/>
                            </group>
                            <group>
                                <button name="action_process_cvs"
                                        type="object"
                                        string="Add Candidates from CVs"
                                        class="oe_highlight"
                                        invisible="not cv_attachment_ids or processing_in_progress"
                                        help="Process all attached CVs that have not yet been successfully processed."/>
                                
                                <button name="action_delete_cv_attachments"
                                        type="object"
                                        string="Delete Attached CVs"
                                        class="btn-danger"
                                        confirm="Are you sure you want to delete all uploaded CV attachments for this job? This action cannot be undone."
                                        invisible="processing_in_progress or (not processing_complete and not processing_failed)"
                                        help="Delete all CVs from the 'CVs to Process' field."/>

                                <div class="o_form_label" 
                                     invisible="not processing_in_progress">
                                    <strong>Processing...</strong>
                                </div>
                                <div invisible="not processing_in_progress">
                                    <span>
                                        <i class="fa fa-spinner fa-spin"/>
                                        Please wait. New applicants are being created.
                                        You will be notified when the process is complete.
                                    </span>
                                </div>
                                
                                <!-- Success Message -->
                                <div class="text-muted" 
                                     invisible="processing_in_progress or not processing_complete or processing_failed">
                                    <strong>Processing Complete.</strong>
                                    <br/>
                                    All CVs processed successfully. You can now delete the attached files.
                                </div>
                                
                                <!-- Failure Message -->
                                <div class="text-danger" 
                                     invisible="processing_in_progress or not processing_failed">
                                    <strong>Processing Failed.</strong>
                                    <br/>
                                    One or more CVs could not be processed. You can click "Add Candidates" to retry the failed files, or delete all files to start over.
                                </div>
                            </group>
                        </group>
                        <field name="processing_in_progress" invisible="1"/>
                        <field name="processing_complete" invisible="1"/>
                        <field name="processing_failed" invisible="1"/>
                    </page>
                </xpath>
            </field>
        </record>

    </data>
</odoo>